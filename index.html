<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            collection, 
            setDoc, 
            getDoc, 
            onSnapshot,
            serverTimestamp,
            getDocs,
            query,
            where
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";


        // --- SECURITY FIX: Use Placeholder for GitHub Actions Injection ---
        const SECURE_FIREBASE_CONFIG = {
            apiKey: "$$FIREBASE_API_KEY$$",
            authDomain: "rootsage-93b81.firebaseapp.com",
            projectId: "rootsage-93b81",
            storageBucket: "rootsage-93b81.firebasestorage.app",
            messagingSenderId: "1030097757643",
            appId: "1:1030097757643:web:60af064ed2e83c78fd824e"
        };
        // ------------------------------------------------------------------

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Initialize Firebase
        const firebaseApp = initializeApp(SECURE_FIREBASE_CONFIG);
        const db = getFirestore(firebaseApp);
        const auth = getAuth(firebaseApp);
        
        // Expose Firebase functions to the global window object for use in the Babel script
        window.auth = auth;
        window.db = db;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signInWithPopup = signInWithPopup;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signOut = signOut;
        window.collection = collection;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.onSnapshot = onSnapshot;
        window.serverTimestamp = serverTimestamp;
        window.getDocs = getDocs;
        window.query = query;
        window.where = where;
        
        // NEW: Flag to signal React that Firebase setup is complete
        window.FIREBASE_LOADED = true;
        
        // NEW: Use a custom event to notify React that it's safe to start
        document.dispatchEvent(new CustomEvent('firebase-ready'));

        setLogLevel('Debug');
    </script>


    <div id="root"></div>

    <script type="text/babel">
        // ... all your existing React/Babel code ...
        
        // --- NEW React Rendering Logic ---
        
        const tryRenderApp = () => {
            if (window.FIREBASE_LOADED) {
                ReactDOM.createRoot(document.getElementById('root')).render(<App />);
            }
        };

        // Attempt to render immediately if Firebase loaded fast
        tryRenderApp();

        // Listen for the custom event in case Firebase loading lagged
        document.addEventListener('firebase-ready', tryRenderApp);
        
    </script>
</body>
</html>
